<div class="combat-actions">
    <a data-mod="dodge" class="combat-action ch-status item"><i class="fas fa-reply"></i> {{localize "dodge"}} ({{actor.system.status.dodge.max}})</a>
    <a data-char="attack" class="combat-action ch-weaponless item" data-mod="attackWeaponless"><i class="fa fa-hand-fist"></i> {{localize "attackWeaponless"}} ({{prepare.brawling.attack}})</a>
    <a data-char="parry" class="combat-action ch-weaponless item" data-mod="parryWeaponless"><i class="fa fa-shield-alt"></i> {{localize "parryWeaponless"}} ({{prepare.brawling.parry}})</a>
    <a class="combat-action ch-fallingDamage item"><i class="fas fa-skull-crossbones"></i> {{localize "fallingDamage"}}</a>
</div>
<div class="groupbox melee-weapons">
    <div class="row-section table-title lineheight">
        <div class="title-type col fourty">
            {{localize "closeCombatAttacks"}}
        </div>
        <div class="col five center small onlyMultiColumn">
            {{localize "Group"}}
        </div>
        <div class="col ten center small" data-tooltip="CHAR.ATTACK">
            {{localize "CHARAbbrev.AT"}}
        </div>
        <div class="col ten center small" data-tooltip="CHAR.PARRY">
            {{localize "CHARAbbrev.PA"}}
        </div>

        <div class="col ten center small" data-tooltip="damage">
            {{localize "CHARAbbrev.damage"}}
        </div>
        <div class="col ten center small notOnMinimum">
            <span class="onlyMultiColumn">{{localize "reach"}}</span><span class="onlySingleColumn"><i data-tooltip="reach" class="fas fa-ruler"></i></span>
        </div>
    </div>
    <div class="row-section wrap rowtable inventory">
        {{#each prepare.wornMeleeWeapons as |item i|}}
        <div class="combat-weapon col item row-section" data-item-id="{{item._id}}">
            <div class="combat-item-image col zerofive image {{item.system.damageToolTip.css}}" data-tooltip="{{item.system.damageToolTip.msg}}" style="background-image: url('{{item.img}}')">
                {{#if item.structureMax}}
                <div class="item-structure" style="--a: {{item.structureMax}}; --b: {{item.structureCurrent}}">
                    <div class="inner"></div>
                </div>
                {{/if}}
            </div>
            <div class="combat-item-name thirtyfive col">
                <a class="item-edit">{{item.name}}</a>
            </div>

            <div class="combat-item-skill col five center small onlyMultiColumn">
                {{localize item.system.combatskill.value}}
            </div>
            <div class="combat-item-attack col ten center item" data-item-id="{{item._id}}" data-mod="attack">
                <a data-mode="attack" class="ch-rollCombat d20 die-attack">{{item.attack}}</a>
            </div>
            <div class="combat-item-parry col ten center item" data-item-id="{{item._id}}" data-mod="parry">
                <a data-mode="parry" class="ch-rollCombat d20 die-parry">{{item.parry}}</a>
            </div>

            <div class="combat-item-damage col ten center">
                <a data-mode="damage" class="ch-rollCombat d6 die-damage"><span>{{item.damagedie}}</span></a><span data-tooltip="{{localize 'damageOverThreshold'}}{{item.gripDamageText}}">{{item.damageAdd}}</span>
            </div>
            <div class="combat-item-range col row-section ten center small notOnMinimum">
                <div class="col nintey center">
                    {{localize (concat "Range-" item.system.reach.value)}}
                </div>
                <div class="col ten center very-small row-section wrap flexAlignCenter">
                    <div class="col">
                        <a class="swapWeaponHand">
                            {{#if item.yieldedTwoHand}}
                                <i data-tooltip="wrongGrip.twoHanded" class="fas fa-hands"></i>
                            {{else}}
                                <i data-tooltip="wrongGrip.oneHanded" class="fas fa-hand"></i>
                            {{/if}}
                        </a>
                    </div>
                    {{#if item.system.worn.offHand}}
                    <div class="col">
                        <a><i data-tooltip="offHand" class="fas fa-shield-halved"></i></a>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>
        {{/each}} {{#each prepare.traits.meleeAttack as |item i|}}
        <div class="combat-weapon col item row-section" data-item-id="{{item._id}}">
            <div class="combat-item-image col zerofive image" style="background-image: url('{{item.img}}')">
            </div>
            <div class="combat-item-name thirtyfive col">
                <a class="item-edit">{{item.name}}</a>
            </div>
            <div class="combat-item-skill col five center small onlyMultiColumn">
                {{localize "TYPES.Item.trait"}}
            </div>
            <div class="combat-item-attack col ten center item" data-item-id="{{item._id}}" data-mod="attack">
                <a data-mode="attack" class="ch-rollCombat d20 die-attack">{{item.attack}}</a>
            </div>
            <div class="combat-item-parry col ten center item" data-item-id="{{item._id}}" data-mod="parry">
                {{#if item.parry}} <a data-mode="parry" class="ch-rollCombat d20 die-parry">{{item.parry}}</a> {{else}} - {{/if}}
            </div>
            <div class="combat-item-damage col ten center">
                <a data-mode="damage" class="ch-rollCombat d6 die-damage"><span>{{item.damagedie}}</span></a><span data-tooltip="damageOverThreshold">{{item.damageAdd}}</span>
            </div>
            <div class="combat-item-range col ten center small notOnMinimum">
                {{localize (concat "Range-" item.system.reach.value)}}
            </div>

        </div>
        {{/each}}
    </div>
</div>

<div class="range-weapons groupbox">
    <div class="row-section table-title lineheight">
        <div class="title-type col thirtyfive">
            <b>{{localize "rangeweapons"}}</b>
        </div>
        <div class="col five center small onlyMultiColumn">
            {{localize "Group"}}
        </div>

        <div class="col ten center small" data-tooltip="CHAR.ATTACK">
            {{localize "CHARAbbrev.AT"}}
        </div>
        <div class="col ten center small" data-tooltip="damage">
            {{localize "CHARAbbrev.damage"}}
        </div>

        <div class="col five center small max20">
            {{localize "TYPES.Item.ammunition"}}
        </div>
        <div class="col zerofive center onlyMultiColumn">

        </div>
    </div>
    <div class="row-section wrap rowtable inventory">
        {{#each prepare.wornRangedWeapons as |item i|}}
        <div class="combat-weapon-wrapper col item" data-item-id="{{item._id}}">
            <div class="combat-weapon row-section">
                <div class="combat-item-image col zerofive image  {{item.system.damageToolTip.css}}" data-tooltip="{{item.system.damageToolTip.msg}}" style="background-image: url('{{item.img}}')">
                    {{#if item.structureMax}}
                    <div class="item-structure" style="--a: {{item.structureMax}}; --b: {{item.structureCurrent}}">
                        <div class="inner"></div>
                    </div>
                    {{/if}}
                </div>
                <div class="combat-item-name three col">
                    <a class="item-edit">{{item.name}}</a>
                </div>

                <div class="combat-item-skill col five center small onlyMultiColumn">
                    {{localize item.system.combatskill.value}}
                </div>

                <div class="combat-item-attack col ten center item" data-item-id="{{item._id}}" data-mod="attack">
                    <a data-mode="attack" class="ch-rollCombat d20 die-attack">{{item.attack}}</a>
                </div>
                <div class="combat-item-damage col ten center">
                    <a data-mode="damage" class="ch-rollCombat d6 die-damage">{{item.damagedie}}</a><span data-tooltip="{{localize 'damageOverThreshold'}}{{item.damageBonusDescription}}">{{item.damageAdd}}</span>
                </div>

                <div class="combat-item-range col five center max20">
                    {{#if (ne item.system.ammunitiongroup.value "-")}}
                    <div class="row-section">

                        <div class="magazinContainer">
                            {{#if item.ammoMax}}
                            <div class="item-structure" style="--a: {{item.ammoMax}}; --b: {{item.ammoCurrent}}">
                                <div class="inner"></div>
                            </div>
                            {{/if}}
                        </div>

                        <select name="currentAmmo-{{item._id}}" class="ammo-selector" data-item-id="{{item._id}}" data-dtype="String">
                                {{#select item.system.currentAmmo.value}}
                                <option class="ammo-option" value="">None</option>
                                {{#each item.ammo as |ammo a|}}
                                <option class="ammo-option" value="{{ammo._id}}"> ({{ammo.system.quantity.value}})
                                    {{ammo.name}}</option>
                                {{/each}}
                                {{/select}}
                            </select> {{#if (ne item.LZ 0)}}
                        <a class="loadWeapon" data-tooltip="{{item.title}}">
                            <div class="progress blue">
                                <span class="progress-left" style="--transformLeft:{{item.transformLeft}}">
                                    <span class="progress-bar"></span>
                                </span>
                                <span class="progress-right" style="--transformRight:{{item.transformRight}}">
                                    <span class="progress-bar"></span>
                                </span>
                                <div class="progress-value">{{item.progress}}</div>
                            </div>
                        </a> {{/if}}
                    </div>
                    {{else}}
                    <div class="no-ammo">
                        - {{#if (ne item.LZ 0)}}
                        <a class="loadWeapon" data-tooltip="{{item.title}}">
                            <div class="progress blue">
                                <span class="progress-left" style="--transformLeft:{{item.transformLeft}}">
                                    <span class="progress-bar"></span>
                                </span>
                                <span class="progress-right" style="--transformRight:{{item.transformRight}}">
                                    <span class="progress-bar"></span>
                                </span>
                                <div class="progress-value">{{item.progress}}</div>
                            </div>
                        </a> {{/if}}
                    </div>
                    {{/if}}
                </div>
                <div class="col zerofive very-small center onlyMultiColumn">
                    <a class="item-dropdown" data-tooltip="SHEET.Dropdown"><i class="fas fa-chevron-down"></i></a> {{#if item.ammoMax}}
                    <a class="item-swapMag" data-tooltip="SHEET.swapMag"><i class="fas fa-retweet"></i></a> {{/if}}
                </div>
            </div>
            <div class="row-section lineheight expandDetails {{item.detailed}}">
                <div class="col">
                    <ul>
                        <li><b>{{localize "reach"}}</b>: {{item.calculatedRange}}</li>
                        <li><b>{{localize "reloadTime"}}</b>: {{item.LZ}} ({{item.system.reloadTime.progress}})</li>
                    </ul>
                </div>
            </div>
        </div>
        {{/each}} {{#each prepare.traits.rangeAttack as |item i|}}
        <div class="col item" data-item-id="{{item._id}}">
            <div class="row-section">
                <div class="col thirtyfive row-section">
                    <div class="col five image" style="background-image: url('{{item.img}}')">
                    </div>
                    <div class="col eighty">
                        <a class="item-edit">{{item.name}}</a>
                    </div>
                </div>

                <div class="col five center small onlyMultiColumn">
                    {{localize "TYPES.Item.trait"}}
                </div>
                <div class="col ten center item" data-item-id="{{item._id}}" data-mod="attack">
                    <a data-mode="attack" class="ch-rollCombat d20 die-attack">{{item.attack}}</a>
                </div>
                <div class="col eight center">
                    <a data-mode="damage" class="ch-rollCombat d6 die-damage">{{item.damagedie}}</a><span data-tooltip="damageOverThreshold">{{item.damageAdd}}</span>
                </div>
                <div class="col ten">
                    {{#if (ne item.LZ 0)}}
                    <a class="loadWeapon" data-tooltip="{{item.title}}">
                        <div class="progress blue">
                            <span class="progress-left" style="--transformLeft:{{item.transformLeft}}">
                            <span class="progress-bar"></span>
                            </span>
                            <span class="progress-right" style="--transformRight:{{item.transformRight}}">
                            <span class="progress-bar"></span>
                            </span>
                            <div class="progress-value">{{item.progress}}</div>
                        </div>
                    </a> {{/if}}
                </div>
                <div class="col zerofive very-small center onlyMultiColumn">
                    <a class="item-dropdown" data-tooltip="SHEET.Dropdown"><i class="fas fa-chevron-down"></i></a>
                </div>
            </div>
            <div class="row-section lineheight expandDetails {{item.detailed}}">
                <div class="col">
                    <ul>
                        <li><b>{{localize "reach"}}</b>: {{item.system.reach.value}}</li>
                        <li><b>{{localize "reloadTime"}}</b>: {{item.LZ}} ({{item.system.reloadTime.progress}})</li>
                    </ul>
                </div>
            </div>
        </div>
        {{/each}}
    </div>
</div>

<div class="combat-armors groupbox wornArmorItems">
    <div class="row-section table-title lineheight">
        <div class="title-type col two">
            {{localize "Equipment.armor"}}
        </div>
        <div class="protection-complete col four center small">{{localize "protection"}} ({{prepare.armorSum}}{{#if prepare.spellArmor}}<span data-tooltip="spellArmor">, {{prepare.spellArmor}}</span>{{/if}}){{#if prepare.liturgyArmor}}<span data-tooltip="liturgyArmor">, {{prepare.liturgyArmor}}</span>{{/if}}</div>
        <div class="col four center small">{{localize "encumbrance"}}</div>
    </div>
    <div class="row-section wrap rowtable inventory">
        {{#each prepare.wornArmor as |item i|}}
        <div class="col item" data-item-id="{{item._id}}">
            <div class="combat-armor row-section">
                <div class="combat-item-image col zerofive image {{item.system.damageToolTip.css}}" data-tooltip="{{item.system.damageToolTip.msg}}" style="background-image: url('{{item.img}}')">
                    {{#if item.structureMax}}
                    <div class="item-structure" style="--a: {{item.structureMax}}; --b: {{item.structureCurrent}}">
                        <div class="inner"></div>
                    </div>
                    {{/if}}
                </div>
                <div class="combat-item-name col fourty">
                    <a class="item-edit">{{item.name}}</a>
                </div>
                <div class="combat-item-protection col four center">
                    {{item.system.protection.value}}
                </div>
                <div class="combat-item-encumbrance col four center">
                    {{item.system.calculatedEncumbrance}}
                </div>
            </div>

        </div>
        {{/each}} {{#each prepare.traits.armor as |item i|}}
        <div class="col item" data-item-id="{{item._id}}">
            <div class="combat-armor row-section">
                <div class="col zerofive image" style="background-image: url('{{item.img}}')">
                </div>
                <div class="col fourty">
                    <a class="item-edit">{{item.name}}</a>
                </div>
                <div class="col four center">
                    {{item.system.at.value}}
                </div>
                <div class="col four center">
                    -
                </div>
            </div>
        </div>
        {{/each}}
    </div>
</div>

{{> systems/dsa5/templates/actors/parts/horse.html}}

{{> systems/dsa5/templates/actors/parts/swarm.html}}

{{> systems/dsa5/templates/actors/parts/specblock.html currentCat="combat"}}

{{> systems/dsa5/templates/actors/parts/combatskills.html}}